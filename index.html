<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="description" content="Stop overthinking. Pick a task. Do it.">
    <meta name="theme-color" content="#000000">
    <title>Taskman</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="apple-touch-icon" href="icons/icon-192.svg">
</head>
<body>
    <div class="top-controls">
        <button id="theme-toggle" class="top-btn" title="Toggle theme">
            <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="5"/>
                <line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                <line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
            </svg>
            <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
            </svg>
            <svg class="icon-rainbow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 3l1.5 4.5L18 9l-4.5 1.5L12 15l-1.5-4.5L6 9l4.5-1.5L12 3z"/>
                <path d="M5 19l1 3 1-3M18 19l1 3 1-3M11.5 19l.5 2 .5-2" stroke-width="1.5"/>
            </svg>
        </button>
        <button id="sound-toggle" class="top-btn" title="Toggle sound">
            <svg class="icon-sound-on" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
            </svg>
            <svg class="icon-sound-off" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                <line x1="23" y1="9" x2="17" y2="15"/>
                <line x1="17" y1="9" x2="23" y2="15"/>
            </svg>
        </button>
    </div>
    <div id="sync-status" class="sync-status hidden">
        <span class="sync-icon"></span>
        <span class="sync-text"></span>
    </div>
    <div class="app">
        <!-- Main: Pick a Task -->
        <main class="main">
            <div id="prompt-view" class="view">
                <p class="prompt-text">What should I do?</p>
                <div class="filters">
                    <div class="category-wheel" id="picker-category" data-value="shopping" data-index="2" data-focused="true" tabindex="0">
                        <button type="button" class="wheel-item" data-category="work" data-offset="-2">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v3"/></svg>
                            <span class="wheel-label">Work</span>
                        </button>
                        <button type="button" class="wheel-item" data-category="personal" data-offset="-1">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                            <span class="wheel-label">Personal</span>
                        </button>
                        <button type="button" class="wheel-item active" data-category="shopping" data-offset="0">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
                            <span class="wheel-label">Shopping</span>
                        </button>
                        <button type="button" class="wheel-item" data-category="health" data-offset="1">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                            <span class="wheel-label">Health</span>
                        </button>
                        <button type="button" class="wheel-item" data-category="other" data-offset="2">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
                            <span class="wheel-label">Other</span>
                        </button>
                    </div>
                    <div class="time-options-wrap" id="picker-time" data-value="0">
                        <button type="button" class="time-chip selected" data-value="0">∞</button>
                        <button type="button" class="time-chip" data-value="15">15m</button>
                        <button type="button" class="time-chip" data-value="30">30m</button>
                        <button type="button" class="time-chip" data-value="60">1h</button>
                        <button type="button" class="time-chip" data-value="120">2h</button>
                    </div>
                </div>
                <button id="pick-btn" class="btn-pick">Pick a task</button>
            </div>

            <div id="task-view" class="view hidden">
                <button id="close-task" class="task-close">&times;</button>
                <div id="task-category-icon" class="task-category-icon"></div>
                <div id="task-time-limit" class="task-time-limit"></div>
                <h1 id="task-title" class="task-title"></h1>
                <div id="task-timer" class="task-timer hidden">
                    <span id="timer-display">00:00</span>
                    <button id="reset-btn" class="btn-reset">Reset</button>
                </div>
                <div class="task-actions">
                    <button id="start-btn" class="btn-start hidden">Start</button>
                    <button id="done-btn" class="btn-done">Done</button>
                    <button id="skip-btn" class="btn-skip">Skip</button>
                </div>
            </div>

            <div id="empty-view" class="view hidden">
                <p class="empty-text">No tasks match.<br>Add some first.</p>
                <button id="show-add-btn" class="btn-secondary">Add a task</button>
            </div>
        </main>

        <!-- Floating buttons -->
        <button id="auth-toggle" class="floating-btn auth-float" title="Account">
            <svg class="icon-user" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
            </svg>
            <svg class="icon-user-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="8.5" cy="7" r="4"/>
                <polyline points="17 11 19 13 23 9"/>
            </svg>
        </button>
        <button id="manage-toggle" class="floating-btn manage-float" title="Manage tasks">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="3" y1="6" x2="21" y2="6"/>
                <line x1="3" y1="12" x2="21" y2="12"/>
                <line x1="3" y1="18" x2="21" y2="18"/>
            </svg>
        </button>
        <button id="add-toggle" class="floating-btn add-float" title="Add task">+</button>

        <div id="add-modal" class="modal hidden">
            <div class="modal-content add-modal-content">
                <button id="close-modal" class="modal-close">&times;</button>
                <form id="task-form">
                    <div class="add-category-wheel" id="add-category" data-value="shopping" data-index="2">
                        <button type="button" class="wheel-item" data-category="work" data-offset="-2">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v3"/></svg>
                            <span class="wheel-label">Work</span>
                        </button>
                        <button type="button" class="wheel-item" data-category="personal" data-offset="-1">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                            <span class="wheel-label">Personal</span>
                        </button>
                        <button type="button" class="wheel-item active" data-category="shopping" data-offset="0">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
                            <span class="wheel-label">Shopping</span>
                        </button>
                        <button type="button" class="wheel-item" data-category="health" data-offset="1">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                            <span class="wheel-label">Health</span>
                        </button>
                        <button type="button" class="wheel-item" data-category="other" data-offset="2">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
                            <span class="wheel-label">Other</span>
                        </button>
                    </div>
                    <input
                        type="text"
                        id="task-input"
                        class="task-input"
                        placeholder="What needs doing?"
                        required
                        autocomplete="off"
                    >
                    <div class="time-options-wrap" id="add-time" data-value="30">
                        <button type="button" class="time-chip" data-value="0">∞</button>
                        <button type="button" class="time-chip" data-value="15">15m</button>
                        <button type="button" class="time-chip selected" data-value="30">30m</button>
                        <button type="button" class="time-chip" data-value="60">1h</button>
                        <button type="button" class="time-chip" data-value="120">2h</button>
                    </div>
                    <button type="submit" class="btn-add">Add task</button>
                </form>
            </div>
        </div>

        <!-- Manage Tasks Modal -->
        <div id="manage-modal" class="modal hidden">
            <div class="manage-content">
                <div class="manage-header">
                    <h2>Your Tasks</h2>
                    <button id="close-manage" class="modal-close">&times;</button>
                </div>
                <div class="manage-filter-row">
                    <div class="manage-category-filter" id="manage-category-filter" data-value="all">
                        <button type="button" class="filter-chip selected" data-value="all">All</button>
                        <button type="button" class="filter-chip" data-value="work">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v3"/></svg>
                        </button>
                        <button type="button" class="filter-chip" data-value="personal">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        </button>
                        <button type="button" class="filter-chip" data-value="shopping">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
                        </button>
                        <button type="button" class="filter-chip" data-value="health">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                        </button>
                        <button type="button" class="filter-chip" data-value="other">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
                        </button>
                    </div>
                    <div class="manage-status-filter" id="manage-status-filter" data-value="all">
                        <button type="button" class="filter-chip selected" data-value="all">All</button>
                        <button type="button" class="filter-chip" data-value="active">Active</button>
                        <button type="button" class="filter-chip" data-value="completed">Done</button>
                    </div>
                </div>
                <div id="manage-list" class="manage-list">
                    <!-- Tasks rendered here -->
                </div>
                <p id="manage-empty" class="manage-empty hidden">No tasks yet.</p>
                <button id="delete-all-btn" class="btn-delete-all hidden">Delete completed</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast">Task added</div>

    <!-- Sign Up Prompt Modal -->
    <div id="signup-prompt" class="modal hidden">
        <div class="modal-content signup-prompt-content">
            <button id="close-signup-prompt" class="modal-close">&times;</button>
            <div class="signup-prompt-icon">&#9888;</div>
            <h2>Don't lose your progress</h2>
            <p>You've completed <strong id="completed-count">3</strong> tasks! But they're only saved on this device.</p>
            <p class="signup-prompt-warning">If you clear your browser data or switch devices, your tasks will be gone forever.</p>
            <div class="signup-prompt-benefits">
                <div class="benefit">
                    <span class="benefit-icon">&#128274;</span>
                    <span>Secure, encrypted cloud backup</span>
                </div>
                <div class="benefit">
                    <span class="benefit-icon">&#9729;</span>
                    <span>Sync across all your devices</span>
                </div>
                <div class="benefit">
                    <span class="benefit-icon">&#128200;</span>
                    <span>Track your performance over time</span>
                </div>
                <div class="benefit">
                    <span class="benefit-icon">&#9889;</span>
                    <span>Takes 10 seconds, no password needed</span>
                </div>
            </div>
            <button id="signup-prompt-yes" class="btn-add">Save my progress</button>
            <button id="signup-prompt-later" class="btn-secondary">Maybe later</button>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal hidden">
        <div class="modal-content auth-modal-content">
            <button id="close-auth" class="modal-close">&times;</button>

            <!-- Sign In View -->
            <div id="auth-signin" class="auth-view">
                <h2>Sign In</h2>
                <p class="auth-subtitle">Sync your tasks across devices</p>

                <form id="otp-email-form">
                    <input type="email" id="auth-email" class="task-input"
                           placeholder="your@email.com" required autocomplete="email">
                    <button type="submit" class="btn-add">Send Code</button>
                </form>

                <p class="auth-guest-note">Or continue as guest - tasks stay on this device only</p>
            </div>

            <!-- OTP Code Entry View -->
            <div id="auth-otp" class="auth-view hidden">
                <div class="auth-icon-large">&#9993;</div>
                <h2>Enter Code</h2>
                <p class="auth-subtitle-padded">We sent a 6-digit code to <strong id="sent-email"></strong></p>

                <form id="otp-verify-form">
                    <input type="text" id="otp-code" class="task-input otp-input"
                           placeholder="000000" required maxlength="6" pattern="[0-9]{6}"
                           inputmode="numeric" autocomplete="one-time-code">
                    <button type="submit" class="btn-add">Verify</button>
                </form>

                <button id="auth-back" class="btn-secondary">Back</button>
            </div>

            <!-- Signed In View -->
            <div id="auth-account" class="auth-view hidden">
                <h2>Your Account</h2>
                <p class="auth-email" id="account-email"></p>

                <div class="auth-stats">
                    <div class="stat">
                        <span class="stat-value" id="tasks-synced">0</span>
                        <span class="stat-label">Tasks Synced</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value" id="last-sync">Never</span>
                        <span class="stat-label">Last Sync</span>
                    </div>
                </div>

                <div class="analytics-section">
                    <div class="analytics-period-tabs">
                        <button type="button" class="period-tab selected" data-period="daily">Day</button>
                        <button type="button" class="period-tab" data-period="weekly">Week</button>
                        <button type="button" class="period-tab" data-period="monthly">Month</button>
                    </div>

                    <div class="analytics-stat">
                        <span class="analytics-value" id="analytics-completed">0</span>
                        <span class="analytics-label">Tasks Completed</span>
                    </div>

                    <div class="analytics-category-filter" id="analytics-category" data-value="all">
                        <button type="button" class="analytics-chip selected" data-value="all">All</button>
                        <button type="button" class="analytics-chip" data-value="work">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v3"/></svg>
                        </button>
                        <button type="button" class="analytics-chip" data-value="personal">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        </button>
                        <button type="button" class="analytics-chip" data-value="shopping">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
                        </button>
                        <button type="button" class="analytics-chip" data-value="health">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                        </button>
                        <button type="button" class="analytics-chip" data-value="other">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
                        </button>
                    </div>
                </div>

                <button id="sign-out" class="btn-sign-out">Sign Out</button>
            </div>

            <!-- Migration Prompt -->
            <div id="auth-migrate" class="auth-view hidden">
                <h2>Welcome!</h2>
                <p>You have <strong id="migrate-count">0</strong> tasks from guest mode.</p>
                <p class="auth-subtitle">Would you like to sync them to your account?</p>

                <div class="auth-actions">
                    <button id="migrate-yes" class="btn-add">Yes, sync my tasks</button>
                    <button id="migrate-no" class="btn-secondary">No, start fresh</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script src="js/supabase.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/sync.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
